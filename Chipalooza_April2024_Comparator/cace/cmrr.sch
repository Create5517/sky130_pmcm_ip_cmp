v {xschem version=3.4.4 file_version=1.2
}
G {}
K {}
V {}
S {}
E {}
T {CACE testbench cmrr} 580 -870 0 0 0.6 0.6 {}
T {CMRR
} 2885 -645 0 1 1 1 {}
N 1220 -500 1360 -500 {
lab=vout}
N 1340 -440 1480 -440 {
lab=VSUB}
N 1480 -440 1520 -440 {
lab=VSUB}
N 1360 -500 1650 -500 {
lab=vout}
N 400 -680 1040 -680 {
lab=dvdd}
N 400 -680 400 -270 {
lab=dvdd}
N 1080 -680 1080 -560 {
lab=dvdd}
N 1040 -680 1080 -680 {
lab=dvdd}
N 1040 -650 1040 -570 {
lab=avdd}
N 480 -650 1040 -650 {
lab=avdd}
N 470 -650 470 -270 {
lab=avdd}
N 990 -620 990 -590 {
lab=ibias}
N 590 -620 590 -270 {
lab=ibias}
N 800 -400 980 -400 {
lab=ena}
N 1010 -390 1010 -360 {
lab=hsyt_0}
N 880 -360 1010 -360 {
lab=hsyt_0}
N 880 -360 880 -270 {
lab=hsyt_0}
N 1030 -390 1030 -310 {
lab=hsyt_1}
N 960 -310 1030 -310 {
lab=hsyt_1}
N 1040 -280 1040 -270 {
lab=avss}
N 1040 -280 1060 -280 {
lab=avss}
N 1060 -280 1070 -280 {
lab=avss}
N 1070 -430 1070 -280 {
lab=avss}
N 1110 -430 1110 -280 {
lab=dvss}
N 1110 -280 1130 -280 {
lab=dvss}
N 1130 -280 1130 -270 {
lab=dvss}
N 400 -200 1130 -200 {
lab=VSUB}
N 350 -200 400 -200 {
lab=VSUB}
N 680 -200 680 -160 {
lab=VSUB}
N 590 -620 990 -620 {
lab=ibias}
N 470 -650 480 -650 {
lab=avdd}
N 660 -280 660 -270 {
lab=vinp}
N 800 -400 800 -320 {
lab=ena}
N 800 -260 800 -220 {
lab=VSUB}
N 960 -310 960 -300 {
lab=hsyt_1}
N 960 -240 960 -210 {
lab=VSUB}
N 800 -210 800 -200 {
lab=VSUB}
N 400 -210 400 -200 {
lab=VSUB}
N 470 -210 470 -200 {
lab=VSUB}
N 590 -210 590 -200 {
lab=VSUB}
N 660 -210 660 -200 {
lab=VSUB}
N 800 -220 800 -210 {
lab=VSUB}
N 880 -210 880 -200 {
lab=VSUB}
N 960 -210 960 -200 {
lab=VSUB}
N 1130 -210 1130 -200 {
lab=VSUB}
N 1040 -210 1040 -200 {
lab=VSUB}
N 890 -590 890 -550 {
lab=vinp}
N 890 -550 920 -550 {
lab=vinp}
N 750 -430 850 -430 {
lab=vinn}
N 850 -430 890 -430 {
lab=vinn}
N 890 -470 890 -440 {
lab=vinn}
N 890 -470 920 -470 {
lab=vinn}
N 890 -440 890 -430 {
lab=vinn}
N 660 -510 660 -280 {
lab=vinp}
N 2220 -460 2340 -460 {
lab=Vinp_AVOL}
N 2100 -345 2100 -310 {
lab=Vinp_AVOL}
N 2500 -520 2500 -480 {
lab=DVDD}
N 2460 -545 2460 -480 {
lab=AVDD}
N 2490 -230 2530 -230 {
lab=GND}
N 2490 -340 2490 -310 {
lab=GND}
N 2490 -250 2490 -230 {
lab=GND}
N 2490 -310 2490 -250 {
lab=GND}
N 2530 -345 2530 -230 {
lab=GND}
N 2100 -460 2220 -460 {
lab=Vinp_AVOL}
N 2340 -460 2345 -460 {
lab=Vinp_AVOL}
N 2100 -385 2100 -345 {
lab=Vinp_AVOL}
N 2100 -460 2100 -385 {
lab=Vinp_AVOL}
N 2415 -520 2415 -500 {
lab=Vhyst_bias}
N 2360 -520 2415 -520 {
lab=Vhyst_bias}
N 2395 -175 2395 -145 {
lab=GND}
N 2640 -410 2695 -410 {
lab=Vout_AVOL}
N 2700 -410 2700 -295 {
lab=Vout_AVOL}
N 2695 -410 2700 -410 {
lab=Vout_AVOL}
N 2255 -380 2255 -340 {
lab=Vinn_VC}
N 2235 -380 2255 -380 {
lab=Vinn_VC}
N 2395 -300 2395 -235 {
lab=#net1}
N 2395 -275 2410 -275 {
lab=#net1}
N 2410 -300 2410 -275 {
lab=#net1}
N 2430 -300 2430 -280 {
lab=GND}
N 2430 -280 2450 -280 {
lab=GND}
N 2450 -300 2450 -280 {
lab=GND}
N 2450 -280 2490 -280 {
lab=GND}
N 2740 -330 2740 -305 {
lab=Vinn_VC}
N 2330 -380 2340 -380 {
lab=#net2}
N 2255 -380 2260 -380 {
lab=Vinn_VC}
N 2260 -380 2270 -380 {
lab=Vinn_VC}
N 3045 -455 3245 -455 {
lab=Vinp_CM}
N 2965 -340 2965 -305 {
lab=Vinp_CM}
N 3405 -515 3405 -475 {
lab=DVDD}
N 3365 -540 3365 -475 {
lab=AVDD}
N 3395 -225 3435 -225 {
lab=GND}
N 3395 -335 3395 -305 {
lab=GND}
N 3395 -245 3395 -225 {
lab=GND}
N 3395 -305 3395 -245 {
lab=GND}
N 3435 -340 3435 -225 {
lab=GND}
N 2965 -455 3045 -455 {
lab=Vinp_CM}
N 3245 -455 3250 -455 {
lab=Vinp_CM}
N 2965 -380 2965 -340 {
lab=Vinp_CM}
N 2965 -455 2965 -380 {
lab=Vinp_CM}
N 3320 -515 3320 -495 {
lab=Vhyst_bias}
N 3265 -515 3320 -515 {
lab=Vhyst_bias}
N 3300 -170 3300 -140 {
lab=GND}
N 3545 -405 3600 -405 {
lab=Vout_CM}
N 3605 -405 3605 -290 {
lab=Vout_CM}
N 3600 -405 3605 -405 {
lab=Vout_CM}
N 3300 -295 3300 -230 {
lab=#net3}
N 3300 -270 3315 -270 {
lab=#net3}
N 3315 -295 3315 -270 {
lab=#net3}
N 3335 -295 3335 -275 {
lab=GND}
N 3335 -275 3355 -275 {
lab=GND}
N 3355 -295 3355 -275 {
lab=GND}
N 3355 -275 3395 -275 {
lab=GND}
N 3645 -325 3645 -300 {
lab=Vinn_VC2}
N 3080 -375 3085 -375 {
lab=Vinn_VC2}
N 3085 -375 3095 -375 {
lab=Vinn_VC2}
N 3230 -375 3245 -375 {
lab=#net4}
N 3155 -375 3170 -375 {
lab=#net5}
N 3075 -375 3075 -335 {
lab=Vinn_VC2}
N 3075 -375 3080 -375 {
lab=Vinn_VC2}
N 660 -590 890 -590 {
lab=vinp}
N 660 -590 660 -510 {
lab=vinp}
N 750 -430 750 -260 {
lab=vinn}
N 1160 240 1300 240 {
lab=vout}
N 1280 300 1420 300 {
lab=VSUB}
N 1420 300 1460 300 {
lab=VSUB}
N 1300 240 1590 240 {
lab=vout}
N 340 60 980 60 {
lab=dvdd}
N 340 60 340 470 {
lab=dvdd}
N 1020 60 1020 180 {
lab=dvdd}
N 980 60 1020 60 {
lab=dvdd}
N 980 90 980 170 {
lab=avdd}
N 420 90 980 90 {
lab=avdd}
N 410 90 410 470 {
lab=avdd}
N 930 120 930 150 {
lab=ibias}
N 530 120 530 470 {
lab=ibias}
N 740 340 920 340 {
lab=ena}
N 950 350 950 380 {
lab=hsyt_0}
N 820 380 950 380 {
lab=hsyt_0}
N 820 380 820 470 {
lab=hsyt_0}
N 970 350 970 430 {
lab=hsyt_1}
N 900 430 970 430 {
lab=hsyt_1}
N 980 460 980 470 {
lab=avss}
N 980 460 1000 460 {
lab=avss}
N 1000 460 1010 460 {
lab=avss}
N 1010 310 1010 460 {
lab=avss}
N 1050 310 1050 460 {
lab=dvss}
N 1050 460 1070 460 {
lab=dvss}
N 1070 460 1070 470 {
lab=dvss}
N 340 540 1070 540 {
lab=VSUB}
N 290 540 340 540 {
lab=VSUB}
N 620 540 620 580 {
lab=VSUB}
N 530 120 930 120 {
lab=ibias}
N 410 90 420 90 {
lab=avdd}
N 600 460 600 470 {
lab=vinp}
N 740 340 740 420 {
lab=ena}
N 740 480 740 520 {
lab=VSUB}
N 900 430 900 440 {
lab=hsyt_1}
N 900 500 900 530 {
lab=VSUB}
N 740 530 740 540 {
lab=VSUB}
N 340 530 340 540 {
lab=VSUB}
N 410 530 410 540 {
lab=VSUB}
N 530 530 530 540 {
lab=VSUB}
N 600 530 600 540 {
lab=VSUB}
N 740 520 740 530 {
lab=VSUB}
N 820 530 820 540 {
lab=VSUB}
N 900 530 900 540 {
lab=VSUB}
N 1070 530 1070 540 {
lab=VSUB}
N 980 530 980 540 {
lab=VSUB}
N 830 150 830 190 {
lab=vinp}
N 830 190 860 190 {
lab=vinp}
N 690 310 790 310 {
lab=#net6}
N 790 310 830 310 {
lab=#net6}
N 830 270 830 300 {
lab=#net6}
N 830 270 860 270 {
lab=#net6}
N 830 300 830 310 {
lab=#net6}
N 600 230 600 460 {
lab=vinp}
N 600 150 830 150 {
lab=vinp}
N 600 150 600 230 {
lab=vinp}
N 690 310 690 330 {
lab=#net6}
N 690 390 690 400 {
lab=#net7}
N 690 460 690 480 {
lab=vinn}
N 1590 240 1590 320 {
lab=vout}
N 1590 320 1600 320 {
lab=vout}
N 1610 -410 1620 -410 {
lab=vout}
N 1610 -500 1610 -410 {}
C {devices/lab_pin.sym} 1650 -500 2 0 {name=p8 sig_type=std_logic lab=vout


}
C {devices/vsource.sym} 470 -240 0 0 {name=Vavdd value="DC \{Vavdd\}" savecurrent=false}
C {devices/res.sym} 1340 -470 0 0 {name=Rout
value=\{Rout\}
device=resistor}
C {devices/capa.sym} 1480 -470 0 0 {name=Cout
value=\{Cout\}}
C {devices/lab_pin.sym} 1520 -440 0 1 {name=p27 sig_type=std_logic lab=VSUB}
C {devices/vsource.sym} 400 -240 0 0 {name=Vdvdd value="DC \{Vdvdd\}" savecurrent=false}
C {devices/vsource.sym} 800 -290 0 0 {name=Vena value="DC [\{ena\} * \{Vdvdd\}]" savecurrent=false}
C {devices/vsource.sym} 880 -240 0 0 {name=Vhyst0 value="DC [\{Vhyst_0\}* \{Vdvdd\}]" savecurrent=false}
C {devices/vsource.sym} 960 -270 0 0 {name=Vhyst1 value="DC [\{\{Vhyst_1\}* \{Vdvdd\}]" savecurrent=false}
C {devices/vsource.sym} 1040 -240 0 0 {name=Vavss value="DC \{Vavss\}" savecurrent=false}
C {devices/vsource.sym} 1130 -240 0 0 {name=Vdvss value="DC \{Vdvss\}" savecurrent=false}
C {devices/lab_pin.sym} 350 -200 0 0 {name=p1 sig_type=std_logic lab=VSUB}
C {devices/res.sym} 680 -130 0 0 {name=RSUB
value=0.01
device=resistor}
C {devices/gnd.sym} 680 -100 0 0 {name=l1 lab=GND}
C {devices/isource.sym} 590 -240 2 0 {name=Iibias value="DC \{ibias\}"}
C {devices/lab_pin.sym} 400 -520 0 0 {name=p2 sig_type=std_logic lab=dvdd}
C {devices/lab_pin.sym} 470 -520 0 0 {name=p3 sig_type=std_logic lab=avdd}
C {devices/lab_pin.sym} 590 -520 0 0 {name=p4 sig_type=std_logic lab=ibias}
C {devices/lab_pin.sym} 800 -380 0 0 {name=p7 sig_type=std_logic lab=ena}
C {devices/lab_pin.sym} 880 -340 0 0 {name=p9 sig_type=std_logic lab=hsyt_0}
C {devices/lab_pin.sym} 960 -310 0 0 {name=p10 sig_type=std_logic lab=hsyt_1}
C {devices/lab_pin.sym} 1070 -290 0 0 {name=p11 sig_type=std_logic lab=avss}
C {devices/lab_pin.sym} 1110 -320 0 1 {name=p12 sig_type=std_logic lab=dvss}
C {devices/lab_pin.sym} 890 -580 0 0 {name=p5 sig_type=std_logic lab=vinp}
C {devices/lab_pin.sym} 750 -430 0 0 {name=p6 sig_type=std_logic lab=vinn}
C {Chipalooza_April2024_Comparator.sym} 1070 -500 0 0 {name=XDUT}
C {devices/code_shown.sym} -810 -600 0 0 {name=CONTROL only_toplevel=false value=".control
** CMRR is defined as the change in input offset vs. change in common-mode voltage.
tran [\{risetime\} * 2 / 100] [\{risetime\} * 4]
meas tran vhigh1 FIND V(vinp) WHEN V(vout) = [\{Vavdd\} / 2] CROSS=1
meas tran vlow1 FIND V(vinp) WHEN V(vout) = [\{Vavdd\} / 2] CROSS=2
meas tran vhigh2 FIND V(vinp) WHEN V(vout) = [\{Vavdd\} / 2] CROSS=3
meas tran vlow2 FIND V(vinp) WHEN V(vout) = [\{Vavdd\} / 2] CROSS=4

let voffset1 = 0.5 * ($&vhigh1 + $&vlow1) - \{Vcm|minimum\}
let voffset2 = 0.5 * ($&vhigh2 + $&vlow2) - \{Vcm|maximum\}

let cmrr = ($&voffset1 - $&voffset2) / (\{Vcm|maximum\} - \{Vcm|minimum\})
let cmrrdb = 20 * log(abs($&cmrr))

echo $&cmrrdb > \{simpath\}/\{filename\}_\{N\}.data

write ngspice/cmrr.raw

quit
.endc
"}
C {devices/code_shown.sym} -780 -1000 0 0 {name=SETUP only_toplevel=false value="* CACE gensim simulation file \{filename\}_\{N\}
* Generated by CACE gensim, Efabless Corporation (c) 2023
* Find the power supply rejection ratio of the amplifier

.include \{DUT_path\}

.lib \{PDK_ROOT\}/\{PDK\}/libs.tech/combined/sky130.lib.spice \{corner\}

.option TEMP=\{temperature\}
* Flag unsafe operating conditions (exceeds models' specified limits)
.option warn=1
.option savecurrents
.option save all
"}
C {devices/vsource.sym} 660 -240 0 0 {name=VVpos value="DC 1.65 AC 1.65" savecurrent=false}
C {devices/lab_pin.sym} 2500 -520 2 0 {name=p21 sig_type=std_logic lab=DVDD

}
C {devices/lab_pin.sym} 2460 -545 0 0 {name=p40 sig_type=std_logic lab=AVDD

}
C {devices/lab_pin.sym} 2360 -520 0 0 {name=p44 sig_type=std_logic lab=Vhyst_bias

}
C {devices/vsource.sym} 2395 -205 0 0 {name=Vinn13 value=1.8 savecurrent=false}
C {devices/vsource.sym} 2100 -285 0 0 {name=Vinn14 value="1.65 ac 1.65"}
C {devices/gnd.sym} 2490 -230 0 0 {name=l25 lab=GND}
C {devices/gnd.sym} 2395 -145 0 0 {name=l31 lab=GND}
C {devices/gnd.sym} 2100 -255 0 0 {name=l32 lab=GND}
C {devices/vcvs.sym} 2740 -275 0 0 {name=E1 value=3}
C {devices/gnd.sym} 2700 -255 0 0 {name=l34 lab=GND}
C {devices/lab_pin.sym} 2360 -520 0 0 {name=p43 sig_type=std_logic lab=Vhyst_bias

}
C {devices/lab_pin.sym} 2235 -380 0 0 {name=p45 sig_type=std_logic lab=Vinn_VC

}
C {devices/gnd.sym} 2255 -280 0 0 {name=l29 lab=GND}
C {devices/lab_pin.sym} 2740 -330 0 1 {name=p46 sig_type=std_logic lab=Vinn_VC
}
C {devices/res.sym} 2300 -380 1 0 {name=R3
value=1k
footprint=1206
device=resistor
m=1}
C {devices/lab_pin.sym} 2700 -410 0 1 {name=p47 sig_type=std_logic lab=Vout_AVOL
}
C {devices/lab_pin.sym} 2100 -460 0 0 {name=p48 sig_type=std_logic lab=Vinp_AVOL
}
C {devices/lab_pin.sym} 3405 -515 2 0 {name=p49 sig_type=std_logic lab=DVDD

}
C {devices/lab_pin.sym} 3365 -540 0 0 {name=p50 sig_type=std_logic lab=AVDD

}
C {devices/lab_pin.sym} 3265 -515 0 0 {name=p51 sig_type=std_logic lab=Vhyst_bias

}
C {devices/vsource.sym} 3300 -200 0 0 {name=Vinn6 value=1.8 savecurrent=false}
C {devices/vsource.sym} 2965 -280 0 0 {name=Vinn15 value="1.65 ac 1.65"}
C {devices/gnd.sym} 3395 -225 0 0 {name=l33 lab=GND}
C {devices/gnd.sym} 3300 -140 0 0 {name=l35 lab=GND}
C {devices/gnd.sym} 2965 -250 0 0 {name=l36 lab=GND}
C {devices/vcvs.sym} 3645 -270 0 0 {name=E2 value=3}
C {devices/gnd.sym} 3605 -250 0 0 {name=l37 lab=GND}
C {devices/lab_pin.sym} 3265 -515 0 0 {name=p52 sig_type=std_logic lab=Vhyst_bias

}
C {devices/lab_pin.sym} 3645 -325 0 1 {name=p54 sig_type=std_logic lab=Vinn_VC2
}
C {devices/res.sym} 3125 -375 1 0 {name=R4
value=1k
footprint=1206
device=resistor
m=1}
C {devices/lab_pin.sym} 3605 -405 0 1 {name=p55 sig_type=std_logic lab=Vout_CM
}
C {devices/lab_pin.sym} 2965 -455 0 0 {name=p56 sig_type=std_logic lab=Vinp_CM}
C {devices/vsource.sym} 3200 -375 1 0 {name=Vinn16 value=1.65 savecurrent=false}
C {devices/capa.sym} 2255 -310 0 0 {name=C3
m=1
value=1e6
footprint=1206
device="ceramic capacitor"}
C {devices/capa.sym} 3075 -305 0 0 {name=C5
m=1
value=1e6
footprint=1206
device="ceramic capacitor"}
C {devices/gnd.sym} 3075 -275 0 0 {name=l38 lab=GND}
C {devices/lab_pin.sym} 3075 -375 0 0 {name=p53 sig_type=std_logic lab=Vinn_VC2
}
C {devices/capa.sym} 750 -230 0 0 {name=C1
m=1
value=1e6
footprint=1206
device="ceramic capacitor"}
C {devices/lab_pin.sym} 1590 240 2 0 {name=p13 sig_type=std_logic lab=vout


}
C {devices/vsource.sym} 410 500 0 0 {name=Vavdd1 value="DC \{Vavdd\}" savecurrent=false}
C {devices/res.sym} 1280 270 0 0 {name=Rout1
value=\{Rout\}
device=resistor}
C {devices/capa.sym} 1420 270 0 0 {name=Cout1
value=\{Cout\}}
C {devices/lab_pin.sym} 1460 300 0 1 {name=p14 sig_type=std_logic lab=VSUB}
C {devices/vsource.sym} 340 500 0 0 {name=Vdvdd1 value="DC \{Vdvdd\}" savecurrent=false}
C {devices/vsource.sym} 740 450 0 0 {name=Vena1 value="DC [\{ena\} * \{Vdvdd\}]" savecurrent=false}
C {devices/vsource.sym} 820 500 0 0 {name=Vhyst2 value="DC [\{Vhyst_0\}* \{Vdvdd\}]" savecurrent=false}
C {devices/vsource.sym} 900 470 0 0 {name=Vhyst3 value="DC [\{\{Vhyst_1\}* \{Vdvdd\}]" savecurrent=false}
C {devices/vsource.sym} 980 500 0 0 {name=Vavss1 value="DC \{Vavss\}" savecurrent=false}
C {devices/vsource.sym} 1070 500 0 0 {name=Vdvss1 value="DC \{Vdvss\}" savecurrent=false}
C {devices/lab_pin.sym} 290 540 0 0 {name=p15 sig_type=std_logic lab=VSUB}
C {devices/res.sym} 620 610 0 0 {name=RSUB1
value=0.01
device=resistor}
C {devices/gnd.sym} 620 640 0 0 {name=l2 lab=GND}
C {devices/isource.sym} 530 500 2 0 {name=Iibias1 value="DC \{ibias\}"}
C {devices/lab_pin.sym} 340 220 0 0 {name=p16 sig_type=std_logic lab=dvdd}
C {devices/lab_pin.sym} 410 220 0 0 {name=p17 sig_type=std_logic lab=avdd}
C {devices/lab_pin.sym} 530 220 0 0 {name=p18 sig_type=std_logic lab=ibias}
C {devices/lab_pin.sym} 740 360 0 0 {name=p19 sig_type=std_logic lab=ena}
C {devices/lab_pin.sym} 820 400 0 0 {name=p20 sig_type=std_logic lab=hsyt_0}
C {devices/lab_pin.sym} 900 430 0 0 {name=p22 sig_type=std_logic lab=hsyt_1}
C {devices/lab_pin.sym} 1010 450 0 0 {name=p23 sig_type=std_logic lab=avss}
C {devices/lab_pin.sym} 1050 420 0 1 {name=p24 sig_type=std_logic lab=dvss}
C {devices/lab_pin.sym} 830 160 0 0 {name=p25 sig_type=std_logic lab=vinp}
C {devices/lab_pin.sym} 690 470 0 0 {name=p26 sig_type=std_logic lab=vinn}
C {Chipalooza_April2024_Comparator.sym} 1010 240 0 0 {name=XDUT1}
C {devices/vsource.sym} 600 500 0 0 {name=VVpos1 value="DC 1.65 AC 1.65" savecurrent=false}
C {devices/capa.sym} 690 510 0 0 {name=C2
m=1
value=1e6
footprint=1206
device="ceramic capacitor"}
C {devices/vsource.sym} 690 360 0 0 {name=VVpos2 value="DC 1.65" savecurrent=false}
C {devices/res.sym} 690 430 0 0 {name=R2
value=1k
footprint=1206
device=resistor
m=1}
C {devices/vcvs.sym} 1640 340 0 0 {name=E3 value=3}
C {devices/lab_pin.sym} 1600 360 0 0 {name=p28 sig_type=std_logic lab=VSUB}
C {devices/lab_pin.sym} 1640 310 0 1 {name=p29 sig_type=std_logic lab=vinn}
C {devices/lab_pin.sym} 1640 370 0 0 {name=p30 sig_type=std_logic lab=VSUB}
C {devices/vcvs.sym} 1660 -390 0 0 {name=E4 value=3}
C {devices/lab_pin.sym} 1620 -370 0 0 {name=p31 sig_type=std_logic lab=VSUB}
C {devices/lab_pin.sym} 1660 -420 0 1 {name=p32 sig_type=std_logic lab=vinn}
C {devices/lab_pin.sym} 1660 -360 0 0 {name=p33 sig_type=std_logic lab=VSUB}
